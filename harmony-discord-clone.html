<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Harmony - Discord Clone</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-darkest: #0a0a0f;
            --bg-darker: #111118;
            --bg-dark: #1a1a24;
            --bg-medium: #23232f;
            --bg-light: #2d2d3a;
            --bg-lighter: #383848;
            --accent-primary: #7c5cff;
            --accent-secondary: #5c8cff;
            --accent-gradient: linear-gradient(135deg, #7c5cff 0%, #5c8cff 50%, #5cffb8 100%);
            --accent-glow: rgba(124, 92, 255, 0.4);
            --text-primary: #ffffff;
            --text-secondary: #b8b8c8;
            --text-muted: #6e6e82;
            --success: #5cffb8;
            --warning: #ffb85c;
            --danger: #ff5c8a;
            --online: #5cffb8;
            --idle: #ffb85c;
            --dnd: #ff5c8a;
            --offline: #6e6e82;
            --radius-sm: 6px;
            --radius-md: 10px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            --shadow-glow: 0 0 30px rgba(124, 92, 255, 0.2);
            --shadow-card: 0 4px 24px rgba(0, 0, 0, 0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg-darkest);
            color: var(--text-primary);
            overflow: hidden;
            height: 100vh;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: var(--bg-lighter);
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-primary);
        }

        /* Main Layout */
        .app {
            display: grid;
            grid-template-columns: 72px 240px 1fr;
            height: 100vh;
        }

        .app.voice-active {
            grid-template-columns: 72px 240px 1fr 320px;
        }

        /* Server List */
        .server-list {
            background: var(--bg-darkest);
            padding: 12px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            overflow-y: auto;
        }

        .server-icon {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--bg-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            font-weight: 600;
            font-size: 18px;
            color: var(--text-secondary);
        }

        .server-icon:hover {
            border-radius: var(--radius-lg);
            background: var(--accent-primary);
            color: white;
        }

        .server-icon.active {
            border-radius: var(--radius-lg);
            background: var(--accent-gradient);
        }

        .server-icon::before {
            content: '';
            position: absolute;
            left: -12px;
            width: 4px;
            height: 0;
            background: var(--text-primary);
            border-radius: 0 4px 4px 0;
            transition: height 0.2s;
        }

        .server-icon:hover::before {
            height: 20px;
        }

        .server-icon.active::before {
            height: 36px;
        }

        .server-icon img {
            width: 100%;
            height: 100%;
            border-radius: inherit;
            object-fit: cover;
        }

        .server-divider {
            width: 32px;
            height: 2px;
            background: var(--bg-light);
            border-radius: 1px;
            margin: 4px 0;
        }

        .server-icon.add-server {
            background: transparent;
            border: 2px dashed var(--bg-lighter);
            color: var(--success);
        }

        .server-icon.add-server:hover {
            background: var(--success);
            border-color: var(--success);
            color: var(--bg-darkest);
        }

        /* Channel Sidebar */
        .channel-sidebar {
            background: var(--bg-darker);
            display: flex;
            flex-direction: column;
        }

        .server-header {
            padding: 16px;
            border-bottom: 1px solid var(--bg-dark);
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            transition: background 0.2s;
        }

        .server-header:hover {
            background: var(--bg-dark);
        }

        .server-header h2 {
            font-size: 15px;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .server-header .dropdown-icon {
            transition: transform 0.2s;
        }

        .channels-container {
            flex: 1;
            overflow-y: auto;
            padding: 8px 0;
        }

        .channel-category {
            padding: 16px 8px 4px 16px;
            display: flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            user-select: none;
        }

        .channel-category span {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-muted);
        }

        .channel-category:hover span {
            color: var(--text-secondary);
        }

        .channel {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            margin: 1px 8px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            color: var(--text-muted);
            transition: all 0.15s;
        }

        .channel:hover {
            background: var(--bg-medium);
            color: var(--text-secondary);
        }

        .channel.active {
            background: var(--bg-light);
            color: var(--text-primary);
        }

        .channel-icon {
            font-size: 18px;
            opacity: 0.7;
        }

        .channel-name {
            font-size: 14px;
            font-weight: 500;
        }

        .channel-users {
            margin-left: auto;
            font-size: 12px;
            color: var(--text-muted);
        }

        /* Voice Connected Panel */
        .voice-status {
            background: var(--bg-dark);
            padding: 12px;
            border-top: 1px solid var(--bg-medium);
        }

        .voice-info {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: rgba(92, 255, 184, 0.1);
            border-radius: var(--radius-sm);
            margin-bottom: 8px;
        }

        .voice-info .status-dot {
            width: 8px;
            height: 8px;
            background: var(--success);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .voice-info .voice-text {
            font-size: 12px;
            color: var(--success);
            font-weight: 500;
        }

        .voice-info .channel-name-small {
            font-size: 11px;
            color: var(--text-muted);
        }

        .voice-controls {
            display: flex;
            gap: 4px;
        }

        .voice-btn {
            flex: 1;
            padding: 8px;
            background: var(--bg-medium);
            border: none;
            border-radius: var(--radius-sm);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.15s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .voice-btn:hover {
            background: var(--bg-light);
            color: var(--text-primary);
        }

        .voice-btn.active {
            background: var(--danger);
            color: white;
        }

        .voice-btn.disconnect {
            background: transparent;
        }

        .voice-btn.disconnect:hover {
            background: var(--danger);
            color: white;
        }

        /* User Panel */
        .user-panel {
            background: var(--bg-darkest);
            padding: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--accent-gradient);
            position: relative;
        }

        .user-avatar .status-indicator {
            position: absolute;
            bottom: -2px;
            right: -2px;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: var(--online);
            border: 3px solid var(--bg-darkest);
        }

        .user-info {
            flex: 1;
            min-width: 0;
        }

        .user-name {
            font-size: 13px;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .user-tag {
            font-size: 11px;
            color: var(--text-muted);
        }

        .user-controls {
            display: flex;
            gap: 4px;
        }

        .user-btn {
            width: 32px;
            height: 32px;
            background: transparent;
            border: none;
            border-radius: var(--radius-sm);
            color: var(--text-muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s;
        }

        .user-btn:hover {
            background: var(--bg-medium);
            color: var(--text-primary);
        }

        /* Main Content */
        .main-content {
            display: flex;
            flex-direction: column;
            background: var(--bg-dark);
        }

        /* Channel Header */
        .channel-header {
            height: 48px;
            padding: 0 16px;
            border-bottom: 1px solid var(--bg-darker);
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 1px 0 rgba(0,0,0,0.2);
        }

        .channel-header .hash {
            font-size: 22px;
            color: var(--text-muted);
        }

        .channel-header h3 {
            font-size: 15px;
            font-weight: 600;
        }

        .channel-header .divider {
            width: 1px;
            height: 24px;
            background: var(--bg-lighter);
        }

        .channel-header .description {
            font-size: 13px;
            color: var(--text-muted);
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .header-actions {
            display: flex;
            gap: 8px;
        }

        .header-btn {
            width: 28px;
            height: 28px;
            background: transparent;
            border: none;
            border-radius: var(--radius-sm);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s;
        }

        .header-btn:hover {
            color: var(--text-primary);
        }

        /* Messages Area */
        .messages-area {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .message-group {
            display: flex;
            gap: 16px;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--accent-gradient);
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 16px;
        }

        .message-content {
            flex: 1;
            min-width: 0;
        }

        .message-header {
            display: flex;
            align-items: baseline;
            gap: 8px;
            margin-bottom: 4px;
        }

        .message-author {
            font-weight: 600;
            font-size: 14px;
            color: var(--accent-secondary);
        }

        .message-timestamp {
            font-size: 11px;
            color: var(--text-muted);
        }

        .message-text {
            font-size: 14px;
            line-height: 1.5;
            color: var(--text-secondary);
            word-wrap: break-word;
        }

        .message-text code {
            font-family: 'JetBrains Mono', monospace;
            background: var(--bg-darker);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 13px;
        }

        /* Message Input */
        .message-input-container {
            padding: 0 16px 24px;
        }

        .message-input-wrapper {
            background: var(--bg-medium);
            border-radius: var(--radius-md);
            display: flex;
            align-items: flex-end;
            padding: 4px 4px 4px 16px;
        }

        .input-actions-left {
            display: flex;
            gap: 4px;
            padding-bottom: 8px;
        }

        .input-btn {
            width: 32px;
            height: 32px;
            background: transparent;
            border: none;
            border-radius: var(--radius-sm);
            color: var(--text-muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s;
        }

        .input-btn:hover {
            color: var(--text-primary);
        }

        .message-input {
            flex: 1;
            background: transparent;
            border: none;
            outline: none;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 14px;
            padding: 12px;
            resize: none;
            min-height: 24px;
            max-height: 200px;
        }

        .message-input::placeholder {
            color: var(--text-muted);
        }

        .input-actions-right {
            display: flex;
            gap: 4px;
            padding-bottom: 4px;
        }

        /* Voice Panel */
        .voice-panel {
            background: var(--bg-darker);
            border-left: 1px solid var(--bg-dark);
            display: flex;
            flex-direction: column;
        }

        .voice-panel-header {
            padding: 12px 16px;
            border-bottom: 1px solid var(--bg-dark);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .voice-panel-header h3 {
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .voice-panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
        }

        /* Video Grid */
        .video-grid {
            display: grid;
            gap: 8px;
            margin-bottom: 12px;
        }

        .video-grid.single {
            grid-template-columns: 1fr;
        }

        .video-grid.double {
            grid-template-columns: 1fr 1fr;
        }

        .video-grid.multi {
            grid-template-columns: 1fr 1fr;
        }

        .video-tile {
            position: relative;
            background: var(--bg-darkest);
            border-radius: var(--radius-md);
            overflow: hidden;
            aspect-ratio: 16/9;
        }

        .video-tile video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .video-tile .no-video {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-medium);
        }

        .video-tile .no-video .avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--accent-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 600;
        }

        .video-tile .user-label {
            position: absolute;
            bottom: 8px;
            left: 8px;
            background: rgba(0,0,0,0.7);
            padding: 4px 8px;
            border-radius: var(--radius-sm);
            font-size: 12px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .video-tile .speaking-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
            animation: pulse 1s infinite;
        }

        .video-tile .tile-actions {
            position: absolute;
            top: 8px;
            right: 8px;
            display: flex;
            gap: 4px;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .video-tile:hover .tile-actions {
            opacity: 1;
        }

        .tile-btn {
            width: 28px;
            height: 28px;
            background: rgba(0,0,0,0.6);
            border: none;
            border-radius: var(--radius-sm);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s;
        }

        .tile-btn:hover {
            background: var(--accent-primary);
        }

        /* Screen Share Section */
        .screen-share-section {
            margin-bottom: 12px;
        }

        .screen-share-section h4 {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-muted);
            margin-bottom: 8px;
        }

        .screen-share-preview {
            background: var(--bg-darkest);
            border-radius: var(--radius-md);
            overflow: hidden;
            position: relative;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }

        .screen-share-preview:hover {
            border-color: var(--accent-primary);
        }

        .screen-share-preview video {
            width: 100%;
            aspect-ratio: 16/9;
            object-fit: contain;
            background: #000;
        }

        .screen-share-preview .label {
            position: absolute;
            bottom: 8px;
            left: 8px;
            background: var(--accent-primary);
            padding: 4px 8px;
            border-radius: var(--radius-sm);
            font-size: 11px;
            font-weight: 600;
        }

        /* Voice Participants */
        .voice-participants h4 {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-muted);
            margin-bottom: 8px;
        }

        .participant {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            border-radius: var(--radius-sm);
            transition: background 0.15s;
        }

        .participant:hover {
            background: var(--bg-dark);
        }

        .participant .avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--accent-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            position: relative;
        }

        .participant .avatar.speaking {
            box-shadow: 0 0 0 3px var(--success);
        }

        .participant .name {
            flex: 1;
            font-size: 13px;
            font-weight: 500;
        }

        .participant .status-icons {
            display: flex;
            gap: 4px;
            color: var(--text-muted);
        }

        .participant .status-icons .muted {
            color: var(--danger);
        }

        /* Voice Actions */
        .voice-actions {
            padding: 12px;
            background: var(--bg-dark);
            border-top: 1px solid var(--bg-medium);
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }

        .action-btn {
            padding: 10px;
            background: var(--bg-medium);
            border: none;
            border-radius: var(--radius-md);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            transition: all 0.15s;
            font-family: inherit;
        }

        .action-btn:hover {
            background: var(--bg-light);
            color: var(--text-primary);
        }

        .action-btn.active {
            background: var(--accent-primary);
            color: white;
        }

        .action-btn.danger {
            background: var(--danger);
            color: white;
        }

        .action-btn .icon {
            font-size: 20px;
        }

        .action-btn .label {
            font-size: 10px;
            font-weight: 500;
        }

        /* Modals */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--bg-dark);
            border-radius: var(--radius-xl);
            width: 90%;
            max-width: 500px;
            box-shadow: var(--shadow-card);
            transform: scale(0.95);
            transition: transform 0.2s;
        }

        .modal-overlay.active .modal {
            transform: scale(1);
        }

        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--bg-medium);
        }

        .modal-header h2 {
            font-size: 20px;
            font-weight: 600;
        }

        .modal-header p {
            font-size: 14px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        .modal-body {
            padding: 20px 24px;
        }

        .share-options {
            display: grid;
            gap: 12px;
        }

        .share-option {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: var(--bg-medium);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.15s;
            border: 2px solid transparent;
        }

        .share-option:hover {
            background: var(--bg-light);
            border-color: var(--accent-primary);
        }

        .share-option .icon-wrapper {
            width: 48px;
            height: 48px;
            background: var(--accent-gradient);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .share-option .text h4 {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .share-option .text p {
            font-size: 13px;
            color: var(--text-muted);
        }

        .modal-footer {
            padding: 16px 24px;
            border-top: 1px solid var(--bg-medium);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        .btn {
            padding: 10px 20px;
            border-radius: var(--radius-md);
            font-family: inherit;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s;
            border: none;
        }

        .btn-secondary {
            background: var(--bg-medium);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background: var(--bg-light);
        }

        .btn-primary {
            background: var(--accent-primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--accent-secondary);
        }

        /* Quality Settings */
        .quality-settings {
            margin-top: 16px;
            padding: 16px;
            background: var(--bg-medium);
            border-radius: var(--radius-md);
        }

        .quality-settings h4 {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .quality-options {
            display: flex;
            gap: 8px;
        }

        .quality-option {
            flex: 1;
            padding: 10px;
            background: var(--bg-dark);
            border: 2px solid transparent;
            border-radius: var(--radius-sm);
            cursor: pointer;
            text-align: center;
            transition: all 0.15s;
        }

        .quality-option:hover {
            border-color: var(--bg-lighter);
        }

        .quality-option.selected {
            border-color: var(--accent-primary);
            background: rgba(124, 92, 255, 0.1);
        }

        .quality-option .res {
            font-size: 14px;
            font-weight: 600;
        }

        .quality-option .fps {
            font-size: 11px;
            color: var(--text-muted);
        }

        /* Fullscreen Video */
        .fullscreen-overlay {
            position: fixed;
            inset: 0;
            background: #000;
            z-index: 2000;
            display: none;
        }

        .fullscreen-overlay.active {
            display: flex;
            flex-direction: column;
        }

        .fullscreen-video {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fullscreen-video video {
            max-width: 100%;
            max-height: 100%;
        }

        .fullscreen-controls {
            padding: 16px;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
        }

        /* Chat Fullscreen Mode */
        .main-content.chat-fullscreen {
            position: fixed;
            inset: 0;
            z-index: 1500;
            width: 100vw;
            height: 100vh;
        }

        .main-content.chat-fullscreen .channel-header {
            background: var(--bg-dark);
        }

        /* Notification Toast */
        .toast-container {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 3000;
        }

        .toast {
            background: var(--bg-light);
            padding: 12px 20px;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-card);
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .toast .icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .toast .icon.success {
            background: var(--success);
            color: var(--bg-darkest);
        }

        .toast .message {
            font-size: 14px;
        }

        /* Active Shares Indicator */
        .active-shares {
            padding: 8px 12px;
            background: rgba(124, 92, 255, 0.1);
            border-radius: var(--radius-sm);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: var(--accent-primary);
        }

        .active-shares .count {
            background: var(--accent-primary);
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: 600;
        }

        /* Input Sources List */
        .input-sources {
            margin-top: 16px;
        }

        .input-sources h4 {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .input-source {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--bg-medium);
            border-radius: var(--radius-sm);
            margin-bottom: 8px;
        }

        .input-source .type-icon {
            width: 36px;
            height: 36px;
            background: var(--bg-light);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .input-source .info {
            flex: 1;
        }

        .input-source .info .name {
            font-size: 13px;
            font-weight: 500;
        }

        .input-source .info .detail {
            font-size: 11px;
            color: var(--text-muted);
        }

        .input-source .stop-btn {
            padding: 6px 12px;
            background: var(--danger);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            font-family: inherit;
        }

        /* SVG Icons inline */
        .icon-svg {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }
    </style>
</head>
<body>
    <div class="app" id="app">
        <!-- Server List -->
        <nav class="server-list">
            <div class="server-icon active" title="Home">
                <svg viewBox="0 0 24 24" width="28" height="28" fill="currentColor">
                    <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                </svg>
            </div>
            <div class="server-divider"></div>
            <div class="server-icon" title="Harmony HQ">H</div>
            <div class="server-icon" title="Dev Team">
                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect fill='%237c5cff' width='100' height='100'/%3E%3Ctext x='50' y='60' text-anchor='middle' fill='white' font-size='40' font-family='sans-serif' font-weight='bold'%3ED%3C/text%3E%3C/svg%3E" alt="Dev">
            </div>
            <div class="server-icon" title="Gaming">üéÆ</div>
            <div class="server-icon" title="Music">üéµ</div>
            <div class="server-divider"></div>
            <div class="server-icon add-server" title="Add Server">+</div>
        </nav>

        <!-- Channel Sidebar -->
        <aside class="channel-sidebar">
            <div class="server-header">
                <h2>Harmony HQ</h2>
                <span class="dropdown-icon">‚ñº</span>
            </div>
            
            <div class="channels-container">
                <div class="channel-category">
                    <span>‚ñº</span>
                    <span>Text Channels</span>
                </div>
                <div class="channel active">
                    <span class="channel-icon">#</span>
                    <span class="channel-name">general</span>
                </div>
                <div class="channel">
                    <span class="channel-icon">#</span>
                    <span class="channel-name">announcements</span>
                </div>
                <div class="channel">
                    <span class="channel-icon">#</span>
                    <span class="channel-name">random</span>
                </div>
                
                <div class="channel-category">
                    <span>‚ñº</span>
                    <span>Voice Channels</span>
                </div>
                <div class="channel" id="voiceChannel1" onclick="joinVoice('General Voice')">
                    <span class="channel-icon">üîä</span>
                    <span class="channel-name">General Voice</span>
                    <span class="channel-users">2</span>
                </div>
                <div class="channel" onclick="joinVoice('Gaming')">
                    <span class="channel-icon">üîä</span>
                    <span class="channel-name">Gaming</span>
                </div>
                <div class="channel" onclick="joinVoice('Music Room')">
                    <span class="channel-icon">üîä</span>
                    <span class="channel-name">Music Room</span>
                </div>
                <div class="channel" onclick="joinVoice('Screen Share')">
                    <span class="channel-icon">üì∫</span>
                    <span class="channel-name">Screen Share</span>
                    <span class="channel-users">1</span>
                </div>
            </div>
            
            <!-- Voice Status (hidden by default) -->
            <div class="voice-status" id="voiceStatus" style="display: none;">
                <div class="voice-info">
                    <div class="status-dot"></div>
                    <div>
                        <div class="voice-text">Voice Connected</div>
                        <div class="channel-name-small" id="connectedChannel">General Voice</div>
                    </div>
                </div>
                <div class="voice-controls">
                    <button class="voice-btn" id="muteBtn" onclick="toggleMute()" title="Mute">üé§</button>
                    <button class="voice-btn" id="deafenBtn" onclick="toggleDeafen()" title="Deafen">üéß</button>
                    <button class="voice-btn" onclick="openShareModal()" title="Share Screen">üì∫</button>
                    <button class="voice-btn disconnect" onclick="leaveVoice()" title="Disconnect">üìû</button>
                </div>
            </div>
            
            <!-- User Panel -->
            <div class="user-panel">
                <div class="user-avatar">
                    <div class="status-indicator"></div>
                </div>
                <div class="user-info">
                    <div class="user-name">You</div>
                    <div class="user-tag">#1234</div>
                </div>
                <div class="user-controls">
                    <button class="user-btn" title="Mute">üé§</button>
                    <button class="user-btn" title="Deafen">üéß</button>
                    <button class="user-btn" title="Settings">‚öôÔ∏è</button>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="channel-header">
                <span class="hash">#</span>
                <h3>general</h3>
                <div class="divider"></div>
                <span class="description">General discussion for the team</span>
                <div class="header-actions">
                    <button class="header-btn" title="Threads">üßµ</button>
                    <button class="header-btn" title="Notifications">üîî</button>
                    <button class="header-btn" title="Pinned">üìå</button>
                    <button class="header-btn" title="Members">üë•</button>
                    <button class="header-btn" id="chatFullscreenBtn" onclick="toggleChatFullscreen()" title="Fullscreen">‚õ∂</button>
                </div>
            </header>
            
            <div class="messages-area" id="messagesArea">
                <div class="message-group">
                    <div class="message-avatar">A</div>
                    <div class="message-content">
                        <div class="message-header">
                            <span class="message-author">Alice</span>
                            <span class="message-timestamp">Today at 10:30 AM</span>
                        </div>
                        <div class="message-text">Hey everyone! Ready for the demo? üéâ</div>
                    </div>
                </div>
                
                <div class="message-group">
                    <div class="message-avatar" style="background: linear-gradient(135deg, #ff5c8a, #ffb85c);">B</div>
                    <div class="message-content">
                        <div class="message-header">
                            <span class="message-author" style="color: #ff5c8a;">Bob</span>
                            <span class="message-timestamp">Today at 10:32 AM</span>
                        </div>
                        <div class="message-text">Yep! Just testing the screen share feature. It supports up to 1080p now!</div>
                    </div>
                </div>
                
                <div class="message-group">
                    <div class="message-avatar" style="background: linear-gradient(135deg, #5cffb8, #5c8cff);">C</div>
                    <div class="message-content">
                        <div class="message-header">
                            <span class="message-author" style="color: #5cffb8;">Charlie</span>
                            <span class="message-timestamp">Today at 10:35 AM</span>
                        </div>
                        <div class="message-text">Nice! Can we share multiple inputs at once? Like screen + camera?</div>
                    </div>
                </div>
                
                <div class="message-group">
                    <div class="message-avatar" style="background: linear-gradient(135deg, #ff5c8a, #ffb85c);">B</div>
                    <div class="message-content">
                        <div class="message-header">
                            <span class="message-author" style="color: #ff5c8a;">Bob</span>
                            <span class="message-timestamp">Today at 10:36 AM</span>
                        </div>
                        <div class="message-text">Absolutely! The new system supports multiple simultaneous shares - screen, window, camera, and even application audio. Just click the share button in voice to try it out.</div>
                    </div>
                </div>
            </div>
            
            <div class="message-input-container">
                <div class="message-input-wrapper">
                    <div class="input-actions-left">
                        <button class="input-btn" title="Attach">‚ûï</button>
                    </div>
                    <textarea class="message-input" id="messageInput" placeholder="Message #general" rows="1" onkeydown="handleKeyDown(event)"></textarea>
                    <div class="input-actions-right">
                        <button class="input-btn" title="GIF">GIF</button>
                        <button class="input-btn" title="Emoji">üòÄ</button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Voice Panel (shown when in voice) -->
        <aside class="voice-panel" id="voicePanel" style="display: none;">
            <div class="voice-panel-header">
                <h3 id="voicePanelTitle">General Voice</h3>
                <button class="header-btn" onclick="expandVideo()">‚õ∂</button>
            </div>
            
            <div class="voice-panel-content">
                <!-- Active Shares Indicator -->
                <div class="active-shares" id="activeSharesIndicator" style="display: none;">
                    <span class="count" id="shareCount">0</span>
                    <span>active share(s)</span>
                </div>
                
                <!-- Screen Share Preview -->
                <div class="screen-share-section" id="screenShareSection" style="display: none;">
                    <h4>Screen Shares</h4>
                    <div id="screenSharePreviews"></div>
                </div>
                
                <!-- Video Grid -->
                <div class="video-grid" id="videoGrid">
                    <div class="video-tile" id="localVideoTile">
                        <div class="no-video">
                            <div class="avatar">Y</div>
                        </div>
                        <video id="localVideo" autoplay muted playsinline style="display: none;"></video>
                        <div class="user-label">
                            <span>You</span>
                        </div>
                        <div class="tile-actions">
                            <button class="tile-btn" onclick="toggleLocalVideo()" title="Toggle Camera">üì∑</button>
                            <button class="tile-btn" onclick="expandVideo()" title="Fullscreen">‚õ∂</button>
                        </div>
                    </div>
                </div>
                
                <!-- Active Input Sources -->
                <div class="input-sources" id="inputSources" style="display: none;">
                    <h4>üì§ Your Active Shares</h4>
                    <div id="inputSourcesList"></div>
                </div>
                
                <!-- Voice Participants -->
                <div class="voice-participants">
                    <h4>In Voice ‚Äî <span id="participantCount">1</span></h4>
                    <div id="participantsList">
                        <div class="participant">
                            <div class="avatar">Y</div>
                            <span class="name">You</span>
                            <div class="status-icons">
                                <span id="selfMuteIcon" style="display: none;">üîá</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="voice-actions">
                <button class="action-btn" id="micBtn" onclick="toggleMute()">
                    <span class="icon">üé§</span>
                    <span class="label">Mute</span>
                </button>
                <button class="action-btn" id="camBtn" onclick="toggleCamera()">
                    <span class="icon">üì∑</span>
                    <span class="label">Camera</span>
                </button>
                <button class="action-btn" id="shareBtn" onclick="openShareModal()">
                    <span class="icon">üì∫</span>
                    <span class="label">Share</span>
                </button>
                <button class="action-btn danger" onclick="leaveVoice()">
                    <span class="icon">üìû</span>
                    <span class="label">Leave</span>
                </button>
            </div>
        </aside>
    </div>

    <!-- Share Modal -->
    <div class="modal-overlay" id="shareModal">
        <div class="modal">
            <div class="modal-header">
                <h2>Share Your Screen</h2>
                <p>Choose what you want to share with others</p>
            </div>
            <div class="modal-body">
                <div class="share-options">
                    <div class="share-option" onclick="startScreenShare('screen')">
                        <div class="icon-wrapper">üñ•Ô∏è</div>
                        <div class="text">
                            <h4>Entire Screen</h4>
                            <p>Share your full desktop in 1080p</p>
                        </div>
                    </div>
                    <div class="share-option" onclick="startScreenShare('window')">
                        <div class="icon-wrapper">ü™ü</div>
                        <div class="text">
                            <h4>Application Window</h4>
                            <p>Share a specific application</p>
                        </div>
                    </div>
                    <div class="share-option" onclick="startScreenShare('tab')">
                        <div class="icon-wrapper">üåê</div>
                        <div class="text">
                            <h4>Browser Tab</h4>
                            <p>Share a Chrome tab with audio</p>
                        </div>
                    </div>
                    <div class="share-option" onclick="startCameraShare()">
                        <div class="icon-wrapper">üì∑</div>
                        <div class="text">
                            <h4>Camera Only</h4>
                            <p>Share your webcam feed</p>
                        </div>
                    </div>
                </div>
                
                <div class="quality-settings">
                    <h4>Stream Quality</h4>
                    <div class="quality-options">
                        <div class="quality-option" onclick="selectQuality(720, 30)" id="quality720">
                            <div class="res">720p</div>
                            <div class="fps">30 FPS</div>
                        </div>
                        <div class="quality-option selected" onclick="selectQuality(1080, 30)" id="quality1080">
                            <div class="res">1080p</div>
                            <div class="fps">30 FPS</div>
                        </div>
                        <div class="quality-option" onclick="selectQuality(1080, 60)" id="quality1080_60">
                            <div class="res">1080p</div>
                            <div class="fps">60 FPS</div>
                        </div>
                        <div class="quality-option" onclick="selectQuality(1440, 30)" id="quality1440">
                            <div class="res">1440p</div>
                            <div class="fps">30 FPS</div>
                        </div>
                        <div class="quality-option" onclick="selectQuality(1440, 60)" id="quality1440_60">
                            <div class="res">1440p</div>
                            <div class="fps">60 FPS</div>
                        </div>
                        <div class="quality-option" onclick="selectQuality(2160, 30)" id="quality4k">
                            <div class="res">4K</div>
                            <div class="fps">30 FPS</div>
                        </div>
                        <div class="quality-option" onclick="selectQuality(2160, 60)" id="quality4k_60">
                            <div class="res">4K</div>
                            <div class="fps">60 FPS</div>
                        </div>
                        <div class="quality-option" onclick="selectQuality(4320, 30)" id="quality8k">
                            <div class="res">8K</div>
                            <div class="fps">30 FPS</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeShareModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Fullscreen Overlay -->
    <div class="fullscreen-overlay" id="fullscreenOverlay">
        <div class="fullscreen-video">
            <video id="fullscreenVideo" autoplay playsinline></video>
        </div>
        <div class="fullscreen-controls">
            <button class="action-btn" onclick="toggleMute()">
                <span class="icon">üé§</span>
                <span class="label">Mute</span>
            </button>
            <button class="action-btn" onclick="toggleCamera()">
                <span class="icon">üì∑</span>
                <span class="label">Camera</span>
            </button>
            <button class="action-btn" onclick="closeFullscreen()">
                <span class="icon">‚úï</span>
                <span class="label">Exit</span>
            </button>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // State Management
        const state = {
            inVoice: false,
            currentChannel: null,
            isMuted: false,
            isDeafened: false,
            isCameraOn: false,
            selectedQuality: { width: 1920, height: 1080, frameRate: 30 },
            activeShares: [],
            localStream: null,
            screenStreams: [],
            participants: [
                { id: 'self', name: 'You', avatar: 'Y', isMuted: false, isSpeaking: false }
            ]
        };

        // Simulated other participants
        const otherParticipants = [
            { id: 'alice', name: 'Alice', avatar: 'A', color: '#7c5cff' },
            { id: 'bob', name: 'Bob', avatar: 'B', color: '#ff5c8a' }
        ];

        // Join Voice Channel
        function joinVoice(channelName) {
            state.inVoice = true;
            state.currentChannel = channelName;
            
            document.getElementById('app').classList.add('voice-active');
            document.getElementById('voiceStatus').style.display = 'block';
            document.getElementById('voicePanel').style.display = 'flex';
            document.getElementById('connectedChannel').textContent = channelName;
            document.getElementById('voicePanelTitle').textContent = channelName;
            
            // Add simulated participants after a delay
            setTimeout(() => {
                addParticipant(otherParticipants[0]);
                showToast('Alice joined the voice channel', 'success');
            }, 1500);
            
            setTimeout(() => {
                addParticipant(otherParticipants[1]);
                showToast('Bob joined the voice channel', 'success');
            }, 3000);
            
            showToast(`Joined ${channelName}`, 'success');
        }

        // Leave Voice Channel
        function leaveVoice() {
            state.inVoice = false;
            state.currentChannel = null;
            
            // Stop all streams
            stopAllShares();
            
            document.getElementById('app').classList.remove('voice-active');
            document.getElementById('voiceStatus').style.display = 'none';
            document.getElementById('voicePanel').style.display = 'none';
            
            // Reset participants
            state.participants = [{ id: 'self', name: 'You', avatar: 'Y', isMuted: false, isSpeaking: false }];
            updateParticipantsList();
            
            showToast('Disconnected from voice', 'success');
        }

        // Toggle Mute
        function toggleMute() {
            state.isMuted = !state.isMuted;
            
            const muteBtn = document.getElementById('muteBtn');
            const micBtn = document.getElementById('micBtn');
            const selfMuteIcon = document.getElementById('selfMuteIcon');
            
            if (state.isMuted) {
                muteBtn.classList.add('active');
                muteBtn.innerHTML = 'üîá';
                micBtn.classList.add('active');
                micBtn.querySelector('.icon').textContent = 'üîá';
                selfMuteIcon.style.display = 'inline';
            } else {
                muteBtn.classList.remove('active');
                muteBtn.innerHTML = 'üé§';
                micBtn.classList.remove('active');
                micBtn.querySelector('.icon').textContent = 'üé§';
                selfMuteIcon.style.display = 'none';
            }
            
            // Mute actual stream if exists
            if (state.localStream) {
                state.localStream.getAudioTracks().forEach(track => {
                    track.enabled = !state.isMuted;
                });
            }
        }

        // Toggle Deafen
        function toggleDeafen() {
            state.isDeafened = !state.isDeafened;
            
            const deafenBtn = document.getElementById('deafenBtn');
            
            if (state.isDeafened) {
                deafenBtn.classList.add('active');
                deafenBtn.innerHTML = 'üîà';
                if (!state.isMuted) toggleMute(); // Also mute when deafening
            } else {
                deafenBtn.classList.remove('active');
                deafenBtn.innerHTML = 'üéß';
            }
        }

        // Toggle Camera
        async function toggleCamera() {
            const camBtn = document.getElementById('camBtn');
            const localVideo = document.getElementById('localVideo');
            const noVideoDiv = document.querySelector('#localVideoTile .no-video');
            
            if (!state.isCameraOn) {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({
                        video: {
                            width: { ideal: 1280 },
                            height: { ideal: 720 },
                            frameRate: { ideal: 30 }
                        },
                        audio: true
                    });
                    
                    state.localStream = stream;
                    localVideo.srcObject = stream;
                    localVideo.style.display = 'block';
                    noVideoDiv.style.display = 'none';
                    
                    state.isCameraOn = true;
                    camBtn.classList.add('active');
                    
                    showToast('Camera enabled', 'success');
                } catch (err) {
                    console.error('Camera error:', err);
                    showToast('Could not access camera', 'error');
                }
            } else {
                if (state.localStream) {
                    state.localStream.getTracks().forEach(track => track.stop());
                    state.localStream = null;
                }
                
                localVideo.srcObject = null;
                localVideo.style.display = 'none';
                noVideoDiv.style.display = 'flex';
                
                state.isCameraOn = false;
                camBtn.classList.remove('active');
                
                showToast('Camera disabled', 'success');
            }
        }

        // Open Share Modal
        function openShareModal() {
            document.getElementById('shareModal').classList.add('active');
        }

        // Close Share Modal
        function closeShareModal() {
            document.getElementById('shareModal').classList.remove('active');
        }

        // Select Quality
        function selectQuality(height, fps) {
            document.querySelectorAll('.quality-option').forEach(opt => opt.classList.remove('selected'));

            const qualityMap = {
                720: { width: 1280, height: 720 },
                1080: { width: 1920, height: 1080 },
                1440: { width: 2560, height: 1440 },
                2160: { width: 3840, height: 2160 },
                4320: { width: 7680, height: 4320 }
            };

            const dims = qualityMap[height] || qualityMap[1080];
            state.selectedQuality = { width: dims.width, height: dims.height, frameRate: fps };

            // Update selected UI
            let elementId = '';
            if (height === 720) elementId = 'quality720';
            else if (height === 1080 && fps === 30) elementId = 'quality1080';
            else if (height === 1080 && fps === 60) elementId = 'quality1080_60';
            else if (height === 1440 && fps === 30) elementId = 'quality1440';
            else if (height === 1440 && fps === 60) elementId = 'quality1440_60';
            else if (height === 2160 && fps === 30) elementId = 'quality4k';
            else if (height === 2160 && fps === 60) elementId = 'quality4k_60';
            else if (height === 4320) elementId = 'quality8k';

            if (elementId) document.getElementById(elementId).classList.add('selected');
        }

        // Start Screen Share
        async function startScreenShare(type) {
            closeShareModal();
            
            try {
                const constraints = {
                    video: {
                        width: { ideal: state.selectedQuality.width },
                        height: { ideal: state.selectedQuality.height },
                        frameRate: { ideal: state.selectedQuality.frameRate }
                    },
                    audio: type === 'tab' ? {
                        echoCancellation: true,
                        noiseSuppression: true
                    } : false
                };
                
                let displayMediaOptions = {
                    video: constraints.video,
                    audio: constraints.audio
                };
                
                if (type === 'window') {
                    displayMediaOptions.video.displaySurface = 'window';
                } else if (type === 'tab') {
                    displayMediaOptions.video.displaySurface = 'browser';
                    displayMediaOptions.preferCurrentTab = false;
                    displayMediaOptions.selfBrowserSurface = 'exclude';
                    displayMediaOptions.systemAudio = 'include';
                }
                
                const stream = await navigator.mediaDevices.getDisplayMedia(displayMediaOptions);
                
                const shareId = Date.now();
                const shareInfo = {
                    id: shareId,
                    type: type,
                    stream: stream,
                    label: stream.getVideoTracks()[0].label || `Screen ${state.activeShares.length + 1}`
                };
                
                state.activeShares.push(shareInfo);
                state.screenStreams.push(stream);
                
                // Handle stream end
                stream.getVideoTracks()[0].onended = () => {
                    stopShare(shareId);
                };
                
                updateSharesUI();
                showToast(`Now sharing: ${shareInfo.label}`, 'success');
                
            } catch (err) {
                console.error('Screen share error:', err);
                if (err.name !== 'AbortError') {
                    showToast('Could not start screen share', 'error');
                }
            }
        }

        // Start Camera Share (additional camera)
        async function startCameraShare() {
            closeShareModal();
            
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        width: { ideal: state.selectedQuality.width },
                        height: { ideal: state.selectedQuality.height },
                        frameRate: { ideal: state.selectedQuality.frameRate }
                    },
                    audio: false
                });
                
                const shareId = Date.now();
                const shareInfo = {
                    id: shareId,
                    type: 'camera',
                    stream: stream,
                    label: stream.getVideoTracks()[0].label || 'Camera'
                };
                
                state.activeShares.push(shareInfo);
                
                // Handle stream end
                stream.getVideoTracks()[0].onended = () => {
                    stopShare(shareId);
                };
                
                updateSharesUI();
                showToast('Camera share started', 'success');
                
            } catch (err) {
                console.error('Camera share error:', err);
                showToast('Could not access camera', 'error');
            }
        }

        // Stop specific share
        function stopShare(shareId) {
            const shareIndex = state.activeShares.findIndex(s => s.id === shareId);
            if (shareIndex !== -1) {
                const share = state.activeShares[shareIndex];
                share.stream.getTracks().forEach(track => track.stop());
                state.activeShares.splice(shareIndex, 1);
                updateSharesUI();
                showToast('Stopped sharing', 'success');
            }
        }

        // Stop all shares
        function stopAllShares() {
            state.activeShares.forEach(share => {
                share.stream.getTracks().forEach(track => track.stop());
            });
            state.activeShares = [];
            state.screenStreams = [];
            
            if (state.localStream) {
                state.localStream.getTracks().forEach(track => track.stop());
                state.localStream = null;
            }
            
            updateSharesUI();
        }

        // Update Shares UI
        function updateSharesUI() {
            const indicator = document.getElementById('activeSharesIndicator');
            const screenSection = document.getElementById('screenShareSection');
            const previewsContainer = document.getElementById('screenSharePreviews');
            const inputSources = document.getElementById('inputSources');
            const inputSourcesList = document.getElementById('inputSourcesList');
            
            // Update active shares indicator
            if (state.activeShares.length > 0) {
                indicator.style.display = 'flex';
                document.getElementById('shareCount').textContent = state.activeShares.length;
            } else {
                indicator.style.display = 'none';
            }
            
            // Update screen share previews
            const screenShares = state.activeShares.filter(s => s.type !== 'camera');
            if (screenShares.length > 0) {
                screenSection.style.display = 'block';
                previewsContainer.innerHTML = screenShares.map(share => `
                    <div class="screen-share-preview" onclick="expandShareVideo(${share.id})">
                        <video id="shareVideo_${share.id}" autoplay playsinline muted></video>
                        <div class="label">${share.type === 'tab' ? 'üåê' : 'üñ•Ô∏è'} ${share.label.substring(0, 20)}${share.label.length > 20 ? '...' : ''}</div>
                    </div>
                `).join('');
                
                // Attach streams to videos
                screenShares.forEach(share => {
                    const video = document.getElementById(`shareVideo_${share.id}`);
                    if (video) {
                        video.srcObject = share.stream;
                    }
                });
            } else {
                screenSection.style.display = 'none';
            }
            
            // Update input sources list
            if (state.activeShares.length > 0) {
                inputSources.style.display = 'block';
                inputSourcesList.innerHTML = state.activeShares.map(share => `
                    <div class="input-source">
                        <div class="type-icon">${getShareIcon(share.type)}</div>
                        <div class="info">
                            <div class="name">${share.label.substring(0, 25)}${share.label.length > 25 ? '...' : ''}</div>
                            <div class="detail">${getShareTypeLabel(share.type)} ‚Ä¢ ${state.selectedQuality.height}p${state.selectedQuality.frameRate}fps</div>
                        </div>
                        <button class="stop-btn" onclick="stopShare(${share.id})">Stop</button>
                    </div>
                `).join('');
            } else {
                inputSources.style.display = 'none';
            }
            
            // Update share button state
            const shareBtn = document.getElementById('shareBtn');
            if (state.activeShares.length > 0) {
                shareBtn.classList.add('active');
            } else {
                shareBtn.classList.remove('active');
            }
        }

        function getShareIcon(type) {
            switch(type) {
                case 'screen': return 'üñ•Ô∏è';
                case 'window': return 'ü™ü';
                case 'tab': return 'üåê';
                case 'camera': return 'üì∑';
                default: return 'üì∫';
            }
        }

        function getShareTypeLabel(type) {
            switch(type) {
                case 'screen': return 'Entire Screen';
                case 'window': return 'Window';
                case 'tab': return 'Browser Tab';
                case 'camera': return 'Camera';
                default: return 'Share';
            }
        }

        // Expand share video to fullscreen
        function expandShareVideo(shareId) {
            const share = state.activeShares.find(s => s.id === shareId);
            if (share) {
                const fullscreenVideo = document.getElementById('fullscreenVideo');
                fullscreenVideo.srcObject = share.stream;
                document.getElementById('fullscreenOverlay').classList.add('active');
            }
        }

        // Expand local video
        function expandVideo() {
            const fullscreenVideo = document.getElementById('fullscreenVideo');
            if (state.localStream) {
                fullscreenVideo.srcObject = state.localStream;
            } else if (state.activeShares.length > 0) {
                fullscreenVideo.srcObject = state.activeShares[0].stream;
            }
            document.getElementById('fullscreenOverlay').classList.add('active');
        }

        // Close fullscreen
        function closeFullscreen() {
            document.getElementById('fullscreenOverlay').classList.remove('active');
            document.getElementById('fullscreenVideo').srcObject = null;
        }

        // Toggle chat fullscreen
        function toggleChatFullscreen() {
            const mainContent = document.querySelector('.main-content');
            const btn = document.getElementById('chatFullscreenBtn');
            mainContent.classList.toggle('chat-fullscreen');

            // Update button icon
            if (mainContent.classList.contains('chat-fullscreen')) {
                btn.textContent = '‚õ∂';
                btn.title = 'Exit Fullscreen';
            } else {
                btn.textContent = '‚õ∂';
                btn.title = 'Fullscreen';
            }
        }

        // Add participant
        function addParticipant(participant) {
            state.participants.push({
                id: participant.id,
                name: participant.name,
                avatar: participant.avatar,
                color: participant.color,
                isMuted: false,
                isSpeaking: false
            });
            updateParticipantsList();
            document.getElementById('participantCount').textContent = state.participants.length;
        }

        // Update participants list
        function updateParticipantsList() {
            const list = document.getElementById('participantsList');
            list.innerHTML = state.participants.map(p => `
                <div class="participant">
                    <div class="avatar ${p.isSpeaking ? 'speaking' : ''}" style="${p.color ? `background: ${p.color}` : ''}">${p.avatar}</div>
                    <span class="name">${p.name}</span>
                    <div class="status-icons">
                        ${p.isMuted ? '<span class="muted">üîá</span>' : ''}
                    </div>
                </div>
            `).join('');
        }

        // Show toast notification
        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.innerHTML = `
                <div class="icon ${type}">‚úì</div>
                <span class="message">${message}</span>
            `;
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Handle message input
        function handleKeyDown(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        // Send message
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (message) {
                addMessage('You', message, 'Y', 'var(--accent-gradient)');
                input.value = '';
            }
        }

        // Add message to chat
        function addMessage(author, text, avatar, gradient) {
            const messagesArea = document.getElementById('messagesArea');
            const time = new Date().toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
            
            const messageHTML = `
                <div class="message-group">
                    <div class="message-avatar" style="background: ${gradient};">${avatar}</div>
                    <div class="message-content">
                        <div class="message-header">
                            <span class="message-author">${author}</span>
                            <span class="message-timestamp">Today at ${time}</span>
                        </div>
                        <div class="message-text">${escapeHtml(text)}</div>
                    </div>
                </div>
            `;
            
            messagesArea.insertAdjacentHTML('beforeend', messageHTML);
            messagesArea.scrollTop = messagesArea.scrollHeight;
        }

        // Escape HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Auto-resize textarea
        document.getElementById('messageInput').addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 200) + 'px';
        });

        // Simulate speaking animation
        setInterval(() => {
            if (state.inVoice && state.participants.length > 1) {
                const randomParticipant = state.participants[Math.floor(Math.random() * state.participants.length)];
                randomParticipant.isSpeaking = true;
                updateParticipantsList();
                
                setTimeout(() => {
                    randomParticipant.isSpeaking = false;
                    updateParticipantsList();
                }, 500 + Math.random() * 1000);
            }
        }, 2000);

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Escape to close modals and exit fullscreen
            if (e.key === 'Escape') {
                closeShareModal();
                closeFullscreen();
                // Exit chat fullscreen if active
                const mainContent = document.querySelector('.main-content');
                if (mainContent.classList.contains('chat-fullscreen')) {
                    mainContent.classList.remove('chat-fullscreen');
                    document.getElementById('chatFullscreenBtn').title = 'Fullscreen';
                }
            }
            
            // Ctrl+Shift+M to toggle mute
            if (e.ctrlKey && e.shiftKey && e.key === 'M' && state.inVoice) {
                toggleMute();
            }
            
            // Ctrl+Shift+D to toggle deafen
            if (e.ctrlKey && e.shiftKey && e.key === 'D' && state.inVoice) {
                toggleDeafen();
            }
        });

        // Initialize
        console.log('Harmony Discord Clone loaded!');
        console.log('Features: 1080p screen sharing, multiple input sharing, voice channels');
    </script>
</body>
</html>
